C51 COMPILER V9.54   ADC                                                                   12/11/2017 20:18:13 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN .\Objects\adc.obj
COMPILER INVOKED BY: D:\MDK\C51\BIN\C51.EXE adc.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\adc
                    -.lst) TABS(2) OBJECT(.\Objects\adc.obj)

line level    source

   1          #include "adc.h"
   2          #include "oled.h"
   3          
   4          uint ADValue[2];
   5          
   6          #define ADC_POWER   0x80            //ADC电源控制位
   7          #define ADC_FLAG    0x10            //ADC转换标志位
   8          #define ADC_START   0x08            //ADC开始控制位
   9          #define ADC_SPEED   0x60            //540
  10          
  11          uchar chFlag = 0;
  12          uchar ch[2]={6,7};  //选择P1.6与P1.7作为A/D输入口用
  13          
  14          void Delay(uint n)
  15          {
  16   1          uint x;
  17   1      
  18   1          while (n--)
  19   1          {
  20   2              x = 5000;
  21   2              while (x--);
  22   2          }
  23   1      }
  24          
  25          void ADC_init()
  26          {
  27   1        EA = 1;   //开启总中断
  28   1        EADC = 1; //允许A/D转换
  29   1        P1ASF = 0xC0; //设置P1.7/P1.6为模拟功能
  30   1        ADC_RES = 0;
  31   1        ADC_CONTR |= ADC_POWER; //打开ADC转化电源
  32   1        ADC_CONTR |= ADC_SPEED; //设置AD转换速率 540个时钟转换一次
  33   1        ADC_CONTR |= ADC_START; //AD开始转换
  34   1        Delay(2);
  35   1      }
  36          
  37          void adc_result() interrupt 5
  38          {
  39   1        ADC_CONTR &= !ADC_FLAG;//清零标志位
  40   1        ADValue[chFlag] = ADC_RES*50/256; //计算得到采集回的电压值的10倍数据
  41   1      
  42   1        chFlag = (chFlag+1)%2;
  43   1        ADC_CONTR = ADC_POWER | ADC_SPEED | ADC_START | ch[chFlag];//第二轮转换
  44   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    141    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      7    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.54   ADC                                                                   12/11/2017 20:18:13 PAGE 2   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
